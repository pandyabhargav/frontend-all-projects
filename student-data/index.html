<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>student data</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <style>
        .bg-orange {
            background-color: #FF6E49;
            padding: 30px;
            color: aliceblue;
            text-transform: uppercase;
        }

        .button {
            color: aliceblue;
        }

        .reset,
        .edit,
        .update {
            background-color: #1D9EF0;
            color: aliceblue;
            font-size: 30px;
        }

        .reset,
        .edit,
        .update:hover {
            color: aliceblue;
        }

        .form-control {
            outline: none;
            border: none;
            border-bottom: 2px solid #1D9EF0;
            font-size: 18px;
            text-align: left;
        }

        .form-control:hover {
            outline: transparent;
            border: transparent;
            border-bottom: 2px solid #1D9EF0;
        }

        .serch,
        .trash,
        .Register {
            background-color: #FF6E49;
            font-size: 30px;
        }

        .student {
            background-color: #0059ff;
            font-size: 30px;
        }

        tbody,
        td,
        tfoot,
        th,
        thead {
            border: 2px solid black;
            text-align: center;
        }

        th {
            font-size: 25px;
        }

        .img img {
            border: 1px solid black;
            height: 150px;
            width: 150px;
        }

        .img i {
            position: absolute;
            top: 18%;
            font-size: 40px;
            color: #1D9EF0;
            left: 23%;
        }

        .img input {
            position: absolute;
            top: 18%;
            left: 23%;
            opacity: 0;
            width: 40px;
            height: auto;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" type="text/css" href="https://common.olemiss.edu/_js/sweet-alert/sweet-alert.css">

</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <h2 class="bg-orange">
                    Student's
                </h2>
            </div>

            <div class="col-12 d-flex flex-wrap justify-content-between">
                <div class="d-flex justify-content-center col-3">
                    <button class="btn btn-primary  student m-3 px-3" id="add-btn" data-bs-toggle="modal"
                        data-bs-target="#exampleModal" type="submit"> <i
                            class="fa-solid fa-plus mx-2"></i>Student</button>
                    <button class="btn text-white reset m-3 px-3" type="submit"><i
                            class="fa-solid fa-eraser mx-2"></i>Reset</button>
                </div>
                <div class="d-flex col-5 p-3">
                    <form class="d-flex col-12" role="search">
                        <input class="form-control me-2" id="serch1" type="search" placeholder="Search"
                            aria-label="Search">
                        <button class="btn serch text-white" type="submit">Search</button>
                    </form>
                </div>
            </div>
            <div class="pt-5">
                <table border="1" width=100%>
                    <!-- <thead> -->
                    <tr>
                        <th>
                            No.
                        </th>
                        <th>
                            Profile.
                        </th>
                        <th>
                            Name.
                        </th>
                        <th>
                            Father Name.
                        </th>
                        <th>
                            Contact No.
                        </th>
                        <th>
                            Email.
                        </th>
                        <th>
                            Gender.
                        </th>
                        <th>
                            Catagory.
                        </th>
                        <th>
                            Course.
                        </th>
                        <th>
                            Action.
                        </th>
                    </tr>
                    <tbody id="table-data">

                    </tbody>
                    <!-- </thead> -->
                </table>
            </div>
        </div>
    </div>
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="exampleModalLabel">Modal title</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="d-flex flex-wrap">
                        <form class="d-flex flex-wrap justify-content-center" id="regform" method="post" class="m-5">
                            <div class="col-4">
                                <div class="img d-flex">
                                    <img src="image/add-user.png" id="profil-pic" class="justify-content-start d-flex"
                                        alt="img">
                                    <i class="fa-solid fa-plus"></i>
                                    <input type="file" id="uplode-pic">
                                </div>
                            </div>
                            <div class="col-8">
                                <div>
                                    <label for="na">Name :-</label>
                                    <input type="text" id="na" class="form-control mb-3" required>
                                    <label for="fn">Father No:-</label>
                                    <input type="text" id="fn" class="form-control mb-3" required>
                                    <label for="mo">Contact No :-</label>
                                    <input type="text" id="mo" class="form-control mb-3" required>
                                    <label for="em">Email :-</label>
                                    <input type="text" id="em" class="form-control mb-3" required>
                                    <label for="ge">Gender :-</label>
                                    <input type="text" id="ge" class="form-control mb-3" required>
                                    <label for="ca">Catagory :-</label>
                                    <input type="text" id="ca" class="form-control mb-3" required>
                                    <label for="cor">Course :-</label>
                                    <input type="text" id="cor" class="form-control mb-3" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" id="register"
                                    class="btn Register text-white p-3">Register</button>
                                <button type="submit" id="update" disabled="disabled"
                                    class="btn update p-3">Update</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>








    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <script src="https://common.olemiss.edu/_js/sweet-alert/sweet-alert.min.js"></script>
    <script>
        var userdata = [];
        var addbtn = document.querySelector("#add-btn")
        var clsebtn = document.querySelector(".btn-close");
        var profpic = document.querySelector("#profil-pic");
        var uplodepic = document.querySelector("#uplode-pic");
        var input = document.getElementsByName("INPUT");
        var nael = document.querySelector("#na");
        var fnel = document.querySelector("#fn");
        var moel = document.querySelector("#mo");
        var emel = document.querySelector("#em");
        var geel = document.querySelector("#ge");
        var cael = document.querySelector("#ca");
        var corel = document.querySelector("#cor");
        var registerbtn = document.querySelector("#register");
        var updatebtn = document.querySelector("#update");
        var regformremoveinpt = document.querySelector("#regform");
        var imgUrl;

        // closebutton empty code
        clsebtn.onclick = () => {
            registerbtn.disabled = false;
            updatebtn.disabled = true;
            // input.setAttribute('required', false);
            // input.require;
            nael.value = "";
            fnel.value = "";
            moel.value = "";
            emel.value = "";
            geel.value = "";
            cael.value = "";
            corel.value = "";
            profpic.src = imgUrl == undefined ? "image/add-user.png" : imgUrl;
        }

        registerbtn.onclick = function (e) {
            e.preventDefault();
            registrationdata();
            getdatafromlocal();
            regformremoveinpt.reset();
            clsebtn.click();
        };
        //    jab data dale fir refresh par remove na ho isliye 
        if (localStorage.getItem("userdata") != null) {
            var userdata = JSON.parse(localStorage.getItem("userdata"));
        }

        registrationdata = () => {
            userdata.push({
                name: nael.value,
                fathername: fnel.value,
                mobileno: moel.value,
                email: emel.value,
                gender: geel.value,
                catagory: cael.value,
                course: corel.value,
                profilpic: imgUrl == undefined ? "image/add-user.png" : imgUrl
            });


            var stringData = JSON.stringify(userdata);
            localStorage.setItem("userdata", stringData);
            swal("Good job!", "you Register successfully!", "success")
        }
        // start returning data from local storage to fronend
        var tabledata = document.querySelector("#table-data");
        const getdatafromlocal = () => {
            tabledata.innerHTML = "";
            userdata.forEach((data, index) => {
                tabledata.innerHTML += ` <tr index =${index}><td>${index + 1}</td><td><img src = "${data.profilpic}" width="80" alt ="image"></td><td>${data.name}</td><td>${data.fathername}</td><td>${data.mobileno}</td><td>${data.email}</td><td>${data.gender}</td><td>${data.catagory}</td><td>${data.course}</td><td><button class="btn  edit edit-btn text-white px-4 m-2" type="submit"><i class="fa-solid fa-eye"></i></button><button class="btn  del-btn trash text-white px-4 m-2" type="submit"><i class="fa-solid fa-trash"></i></button></td></tr>`;
            });
            // start delet btton coding
            var i;
            var alldelbtn = document.querySelectorAll(".del-btn");
            for (i = 0; i < alldelbtn.length; i++) {
                alldelbtn[i].onclick = function () {
                    var tr = this.parentElement.parentElement;
                    var id = tr.getAttribute("index");
                    swal({
                        title: "Are you sure?",
                        text: "You will not be able to recover this imaginary file!",
                        type: "warning",
                        showCancelButton: true,
                        confirmButtonColor: "#DD6B55",
                        confirmButtonText: "Yes, delete it!",
                        cancelButtonText: "No, cancel plx!",
                        closeOnConfirm: false,
                        closeOnCancel: false
                    },
                        function (isConfirm) {
                            if (isConfirm) {
                                // 1
                                userdata.splice(id, 1);
                                localStorage.setItem("userdata", JSON.stringify(userdata));
                                tr.remove();
                                // // 0
                                swal("Deleted!", "Your imaginary file has been deleted.", "success");
                            } else {
                                swal("Cancelled", "Your imaginary file is safe :)", "error");
                            }
                        });


                }
            }
            // start edit button coding
            var editbtn = document.querySelectorAll(".edit-btn");
            for (i = 0; i < editbtn.length; i++) {
                editbtn[i].onclick = function () {

                    var tr = this.parentElement.parentElement;
                    var td = tr.getElementsByTagName("TD");
                    var index = tr.getAttribute("index");
                    //  var img_tag = td[1].getAttributeNames("IMG");
                    //  var profile_pic = img_tag[0].src;
                    var profile_pic = td[1].querySelector("img").getAttribute("src");
                    var nam = td[2].innerHTML;
                    var fana = td[3].innerHTML;
                    var mobi = td[4].innerHTML;
                    var ema = td[5].innerHTML;
                    var gend = td[6].innerHTML;
                    var cate = td[7].innerHTML;
                    var cors = td[8].innerHTML;
                    addbtn.click();
                    registerbtn.disabled = true;
                    updatebtn.disabled = false;
                    nael.value = nam;
                    fnel.value = fana;
                    moel.value = mobi;
                    emel.value = ema;
                    geel.value = gend;
                    cael.value = cate;
                    corel.value = cors;
                    profpic.src = profile_pic;
                    updatebtn.onclick = function (e) {
                        e.preventDefault();
                        userdata[index] = {
                            name: nael.value,
                            fathername: fnel.value,
                            mobileno: moel.value,
                            email: emel.value,
                            gender: geel.value,
                            catagory: cael.value,
                            course: corel.value,
                            profilpic: uplodepic.files.length === 0 ? profpic.src : imgUrl
                        };
                        localStorage.setItem("userdata", JSON.stringify(userdata));
                        clsebtn.click();  // Close the modal after updating
                        getdatafromlocal();  // Refresh the table after updating
                    };

                }

            }
        }

        getdatafromlocal();
        // image procesiing

        uplodepic.onchange = function () {
            if (uplodepic.files[0].size < 1000000) {
                var freder = new FileReader();
                freder.onload = function (e) {
                    imgUrl = e.target.result;
                    profpic.src = imgUrl;
                };
                freder.readAsDataURL(uplodepic.files[0]);
            } else {
                alert("File size is too big!");
            }
        };

        // Start search coding
        document.addEventListener('DOMContentLoaded', function () {
            var searchEl = document.querySelector("#serch1");

            if (searchEl) {
                searchEl.addEventListener('input', searchFun);
            } else {
                console.error("Element with ID 'serch' not found");
            }

            searchFun = () => {
                var tableData = document.querySelector("#tabledata");
                if (!tableData) {
                    console.error("Table data with ID 'tabledata' not found");
                    return;
                }

                var tr = tableData.querySelectorAll("tr");
                var filter = searchEl.value.toLowerCase();

                for (var i = 0; i < tr.length; i++) {
                    var td = tr[i].getElementsByTagName("td")[3]; // Ensure proper case for "td"
                    if (td) {
                        var id = td.innerHTML.toLowerCase();
                        if (id.includes(filter)) { // Use includes() for a more straightforward check
                            tr[i].style.display = ""; // Display the row
                        } else {
                            tr[i].style.display = "none"; // Hide the row if it doesn't match
                        }
                    }
                }
            }
        });

    </script>

</body>

</html>